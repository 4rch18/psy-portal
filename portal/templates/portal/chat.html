<button onclick="goBack()">Back</button>
<br>
{% if all %}
    <ul>
    <div id="chat">
    {% for x in all %}
        {% if x.by_admin %}
            <li>{{ x.admin }}(Admin) : {{ x.text }}-----{{x.pub_date}}</li>
        {% else%}
            <li>{{ x.client }} : {{ x.text }}-----{{x.pub_date}}</li>
        {% endif %}
    {% endfor %}
    </div>
    </ul>
{% else %}
    <p>You didn't chat until now</p>
{% endif %}


{%if isAdmin %}
1

<form action="{% url 'portal:admin_chat' client.id admin.id %}" method="POST">
  {% csrf_token %}
  <br>
    <input type="text" name="new_msg"><br>
    <input type="submit" value="Send">
</form>

{% else %}
2
<form action="{% url 'portal:chat' client.id admin.id %}" method="POST">
  {% csrf_token %}
  <br>
  <input type="text" name="new_msg"><br>
    <input type="submit" value="Send">
</form>
{% endif %}




<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

<script>
function afterLoad() {

    {% if isAdmin %}
        setInterval(function(){ adminFunction(); }, 4000);
    {% else %}
        setInterval(function(){ clientFunction(); }, 4000);
    {% endif %}
}

window.onload=afterLoad();


function clientFunction()
{
    $.get("/portal/getData/{{client.id}}/{{admin.id}}/", function(data, status)
        {
            data = JSON.parse(data);
            val =data['type'];
            console.log("Data: " + val + "\nStatus: " + status);
            if (val==1)
            {
                //do nothing
            }
            else if(val==2)
            {
                $("#chat").load("{% url 'portal:chat' client.id admin.id %} #chat");
                //location.reload();
            }
        }); 
}


function adminFunction()
{
    $.get("/portal/admin_getData/{{client.id}}/{{admin.id}}/", function(data, status)
        {
            data = JSON.parse(data);
            val =data['type'];
            console.log("Data: " + val + "\nStatus: " + status);
            if (val==1)
            {
                //do nothing
            }
            else if(val==2)
            {
                $("#chat").load("{% url 'portal:admin_chat' client.id admin.id %} #chat");
                //location.reload();
            }
        }); 
}
</script>


<script>
function goBack() {
    window.history.back();
}
</script>
